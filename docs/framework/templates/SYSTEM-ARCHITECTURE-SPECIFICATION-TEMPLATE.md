# 系統規格架構書（System Specification Architecture）

**Feature ID**: [FEATURE-ID]  
**Feature Name**: [FEATURE-NAME]  
**Version**: 1.0.0  
**Date Created**: [DATE]  
**Last Modified**: [DATE]  
**Author**: [AUTHOR]  
**Status**: [DRAFT | REVIEW | APPROVED]

---

## 1. 概述

### 1.1 目的
本文件在 SEooC 規格的基礎上，定義系統規格架構，將技術安全需求（TSR）分配（allocate）到具體的硬體安全需求（HSR）和軟體安全需求（SSR），並定義硬體/軟體的具體實現邊界、介面和職責。

### 1.2 適用範圍
- **產品**: [PRODUCT-NAME]
- **系統/模塊**: [SYSTEM-NAME]
- **ASIL等級**: [ASIL-A | ASIL-B | ASIL-C | ASIL-D | QM]
- **版本**: [SYSTEM-VERSION]

### 1.3 相關文件
- **SEooC 規格**: [參考編號 - TSR 來源]
- **硬體設計規格**: [參考編號 - HSR 詳細實現]
- **軟體設計規格**: [參考編號 - SSR 詳細實現]
- **系統整合計畫**: [參考編號]

---

## 2. 架構概述

### 2.1 系統分解圖
```
[系統名稱]
├─ [硬體子系統 1]
│  ├─ [硬體模塊 1.1]
│  ├─ [硬體模塊 1.2]
│  └─ [硬體模塊 1.3]
├─ [硬體子系統 2]
│  └─ [硬體模塊 2.1]
└─ [軟體子系統]
   ├─ [軟體模塊 A]
   ├─ [軟體模塊 B]
   └─ [軟體模塊 C]
```

### 2.2 高層架構圖
```
┌─────────────────────────────────────┐
│      [System Name]                   │
│ ┌─────────────────────────────────┐ │
│ │  硬體子系統 (Hardware)           │ │
│ │  ┌──────────┐  ┌──────────┐    │ │
│ │  │ HW Mod 1 │  │ HW Mod 2 │    │ │
│ │  └────┬─────┘  └────┬─────┘    │ │
│ │       │              │          │ │
│ │   [HSR 介面]    [HSR 介面]     │ │
│ │       │              │          │ │
│ └───────┼──────────────┼──────────┘ │
│         │              │            │
│     [硬體/軟體介面]              │
│         │              │            │
│ ┌───────┼──────────────┼──────────┐ │
│ │ ┌─────┴─────┐  ┌─────┴─────┐  │ │
│ │ │ SW Mod A  │  │ SW Mod B  │  │ │
│ │ └───────────┘  └───────────┘  │ │
│ │  軟體子系統 (Software)         │ │
│ └──────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 3. 技術安全需求（TSR）到硬體安全需求（HSR）分配

### 3.1 TSR → HSR 分配表

| TSR ID | TSR 標題 | 實現責任 | 分配 HSR ID | HSR 標題 | 驗證層級 | 狀態 |
|--------|----------|---------|------------|----------|---------|------|
| TSR-001 | [標題] | 硬體 | HSR-001 | [HSR 標題] | 單元測試 | ✓ |
| TSR-002 | [標題] | 硬體/軟體 | HSR-002, SSR-001 | [HSR 標題] | 整合測試 | ✓ |
| TSR-003 | [標題] | 軟體 | SSR-002 | N/A | 單元測試 | ✓ |
| ... | ... | ... | ... | ... | ... | ... |

### 3.2 硬體分配詳情

#### 硬體子系統 1：[子系統名稱]

| HSR ID | 需求文本 | 對應 TSR | 實現模塊 | ASIL | 驗證方法 | 設計文檔 |
|--------|---------|---------|---------|------|---------|---------|
| HSR-001 | [具體硬體需求，如：監控 VDD 電壓，當電壓低於 [X] V 時觸發安全狀態] | TSR-001 | [模塊名] | [ASIL] | [測試] | [參考文檔] |
| HSR-002 | [如：實現故障檢測機制，檢測時序超時] | TSR-002 | [模塊名] | [ASIL] | [測試] | [參考文檔] |
| HSR-NNN | ... | ... | ... | ... | ... | ... |

**硬體實現細節**:
- **故障檢測機制**: [描述硬體如何偵測故障]
- **故障隔離**: [硬體如何隔離故障]
- **故障安全狀態**: [故障發生時的硬體預設狀態]
- **診斷訊號**: [硬體輸出至軟體的診斷訊號定義]

---

## 4. 技術安全需求（TSR）到軟體安全需求（SSR）分配

### 4.1 TSR → SSR 分配表

| TSR ID | TSR 標題 | 實現責任 | 分配 SSR ID | SSR 標題 | 驗證層級 | 狀態 |
|--------|----------|---------|------------|----------|---------|------|
| TSR-002 | [標題] | 硬體/軟體 | SSR-001 | [SSR 標題] | 整合測試 | ✓ |
| TSR-003 | [標題] | 軟體 | SSR-002 | [SSR 標題] | 單元測試 | ✓ |
| TSR-004 | [標題] | 軟體 | SSR-003 | [SSR 標題] | 單元測試 | ✓ |
| ... | ... | ... | ... | ... | ... | ... |

### 4.2 軟體分配詳情

#### 軟體子系統：[子系統名稱]

| SSR ID | 需求文本 | 對應 TSR | 實現模塊 | ASIL | 驗證方法 | 設計文檔 |
|--------|---------|---------|---------|------|---------|---------|
| SSR-001 | [具體軟體需求，如：讀取硬體診斷訊號，當監測到故障時立即進入安全狀態] | TSR-002 | [模塊名] | [ASIL] | [測試] | [參考文檔] |
| SSR-002 | [如：實現故障處理狀態機，處理超時和無效資料] | TSR-003 | [模塊名] | [ASIL] | [測試] | [參考文檔] |
| SSR-003 | [如：記錄故障日誌並通過 CAN/I2C 介面上報] | TSR-004 | [模塊名] | [ASIL] | [測試] | [參考文檔] |
| SSR-NNN | ... | ... | ... | ... | ... | ... |

**軟體實現細節**:
- **故障處理邏輯**: [軟體如何處理硬體報告的故障]
- **狀態機設計**: [故障時的狀態轉遷]
- **恢復機制**: [軟體如何觸發硬體恢復]
- **診斷輸出**: [軟體輸出的診斷資訊]

---

## 5. 硬體/軟體介面定義

### 5.1 介面信號表

| 信號名稱 | 方向 | 寬度 (bits) | 電氣特性 | 時序要求 | 故障處理 | 備註 |
|---------|------|-----------|---------|---------|--------|------|
| FAULT_DETECT | HW→SW | 1 | [TTL/3.3V] | [時序] | [故障時值] | 故障檢測信號 |
| RESET_REQ | SW→HW | 1 | [TTL/3.3V] | [時序] | [復位後狀態] | 軟體復位請求 |
| STATUS_CODE | HW→SW | 8 | [並行/序列] | [時序] | [無效碼] | 故障碼/狀態 |
| ... | ... | ... | ... | ... | ... | ... |

### 5.2 硬體→軟體介面協議

```
[硬體狀態變化] → [信號轉遷] → [軟體中斷/輪詢] → [軟體反應]

例：
故障發生 → FAULT_DETECT 拉低 → 軟體檢測中斷 → 軟體讀取 STATUS_CODE
         → 軟體進入故障處理 → 軟體發送 RESET_REQ → 硬體復位
```

### 5.3 軟體→硬體介面協議

```
[軟體決策] → [控制信號] → [硬體執行] → [硬體反饋]

例：
軟體決定復位 → 軟體發送 RESET_REQ (高脈衝 100ms) → 硬體檢測 → 硬體復位狀態機
            → 硬體復位完成後發送 READY 信號 → 軟體恢復正常運作
```

### 5.4 時序圖

#### 故障檢測與報告
```
HW Clock     ─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─
             
FAULT_DETECT ─┐         ┌─────────────
              └─────────┘             
              
STATUS_CODE  ═════════════╤═════════════════════════
             之前值       │ [0xA1 故障碼]
                          └─ 故障時刻
```

#### 軟體復位流程
```
SW RESET_REQ ─┐           ┌─────────────
              └───────────┘
              
HW READY     ─────┐                   ┌─
                  └───────────────────┘
              
時間軸        t0  t1      t2          t3
```

---

## 6. 分配原則與考量

### 6.1 硬體vs軟體分配決策準則

| 因素 | 分配硬體 | 分配軟體 | 雙重實現 |
|------|---------|---------|--------|
| **關鍵路徑** | ✓ 優先 | 需驗證延遲 | ✓ 考慮 |
| **實時性** | ✓ 硬體更快 | 軟體受限 | ✓ 備用 |
| **故障安全** | ✓ 硬體默認安全狀態 | 軟體可能失效 | ✓ 雙重保障 |
| **成本** | 🔺 可能更高 | ✓ 更靈活 | 🔺 最高 |
| **靈活性** | 🔺 硬體固定 | ✓ 軟體更新 | 折中 |
| **可靠性** | ✓ 無軟體故障風險 | 有軟體故障風險 | ✓ 最高 |

### 6.2 ASIL 繼承原則
- **同級別分配**: HSR/SSR 繼承 TSR 的 ASIL 等級
- **升級論證**: 若認為需要提升，需文檔化技術論證
- **獨立故障假設**: 若硬體和軟體都實現同一需求，可基於獨立故障假設降級

### 6.3 故障診斷覆蓋率 (DC) 考量

| DC 目標 | 實現方式 | 在 HSR/SSR 中的體現 |
|--------|--------|----------------|
| 95%+ | 硬體監控 + 軟體診斷 | HSR：硬體健康檢查；SSR：軟體讀取並驗證 |
| 90-95% | 硬體監控為主 | HSR：完整故障檢測；SSR：故障上報 |
| <90% | 受限監控 | 需論證安全性 |

---

## 7. 追蹤與覆蓋率驗證

### 7.1 需求追蹤矩陣

| SG ID | FSR ID | TSR ID | HSR ID | SSR ID | 驗證狀態 | 上線狀態 |
|-------|--------|--------|--------|--------|---------|---------|
| SG-001 | FSR-001 | TSR-001 | HSR-001 | - | ✓ 完成 | ✓ 上線 |
| SG-002 | FSR-002 | TSR-002 | HSR-002 | SSR-001 | ✓ 完成 | ✓ 上線 |
| SG-003 | FSR-003 | TSR-003 | - | SSR-002 | ✓ 完成 | ✓ 上線 |
| ... | ... | ... | ... | ... | ... | ... |

### 7.2 覆蓋率指標
- **需求覆蓋率**: [X%] - 所有 TSR 都已分配到 HSR/SSR
- **驗證覆蓋率**: [Y%] - 所有 HSR/SSR 都已驗證
- **設計文檔覆蓋率**: [Z%] - 所有 HSR/SSR 都有詳細設計文檔

---

## 8. 介面驗證策略

### 8.1 硬體/軟體介面測試計畫

| 測試場景 | 測試方法 | 預期行為 | 驗收標準 |
|---------|--------|--------|--------|
| 故障檢測 | 注入硬體故障 | 軟體收到信號並進入故障狀態 | 延遲 < [X] ms |
| 信號延遲 | 測量信號傳播時間 | 確認 < 時序要求 | 合格 |
| 邊界狀態 | 測試邊界條件 | 系統進入安全狀態 | 合格 |
| 恢復流程 | 觸發軟體復位 | 硬體正確復位並報告就緒 | 時間 < [Y] ms |

### 8.2 整合測試檢查清單

- [ ] 所有 HSR/SSR 都已映射到設計文檔
- [ ] 所有信號介面都已定義時序
- [ ] 故障檢測/處理邏輯已驗證
- [ ] 恢復流程已測試
- [ ] 邊界條件已測試
- [ ] 診斷覆蓋率已測量
- [ ] 追蹤矩陣已完成且無缺口

---

## 9. 配置與版本管理

### 9.1 版本歷史
| 版本 | 日期 | 作者 | 主要變更 | 審查人 | 狀態 |
|------|------|------|---------|--------|------|
| 1.0.0 | [DATE] | [AUTHOR] | 初始版本 | [REVIEWER] | APPROVED |
| ... | ... | ... | ... | ... | ... |

### 9.2 變更控制記錄
| CR # | 日期 | 變更描述 | 影響 HSR/SSR | 核准 |
|-----|------|---------|-----------|------|
| CR-001 | [DATE] | [變更說明] | HSR-001, SSR-002 | ✓ |
| ... | ... | ... | ... | ... |

---

## 10. 附錄

### 10.1 縮寫和術語
| 術語 | 定義 |
|------|------|
| HSR | Hardware Safety Requirement（硬體安全需求） |
| SSR | Software Safety Requirement（軟體安全需求） |
| TSR | Technical Safety Requirement（技術安全需求） |
| DC | Diagnostic Coverage（診斷覆蓋率） |
| ASIL | Automotive Safety Integrity Level（汽車功能安全完整性等級） |

### 10.2 參考文件
- SEooC 規格 (SEOOC-SPECIFICATION.md)
- ISO 26262 系列標準
- 硬體設計規格
- 軟體設計規格
- 系統整合計畫

### 10.3 簽核
| 角色 | 名字 | 簽署 | 日期 |
|------|------|------|------|
| 作者 | [AUTHOR] | _____ | [DATE] |
| 硬體設計主管 | [HW-LEAD] | _____ | [DATE] |
| 軟體設計主管 | [SW-LEAD] | _____ | [DATE] |
| 系統整合主管 | [SI-LEAD] | _____ | [DATE] |
| 首席架構師 | [CHIEF-ARCHITECT] | _____ | [DATE] |

---

**End of System Specification Architecture Document**
