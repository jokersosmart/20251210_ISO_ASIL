# 規格澄清文檔 - 需求層級與驗證標準

**版本**: 1.1.0  
**日期**: 2025-12-02  
**語言**: 繁體中文 (zh-TW)  
**狀態**: 已批准 (包含 Session 6 澄清)

---

## 目錄

1. [澄清結果 (Session 6)](#澄清結果-session-6)
2. [規格層級架構](#規格層級架構)
3. [每層級的需求標準](#每層級的需求標準)
4. [可驗證性準則](#可驗證性準則)
5. [追蹤完整性標準](#追蹤完整性標準)
6. [ASIL 繼承規則](#asil-繼承規則)
7. [驗證方法對應](#驗證方法對應)
8. [常見澄清](#常見澄清)
9. [檢查清單](#檢查清單)

---

## 澄清結果 (Session 6)

本部分記錄 2025-12-02 規格澄清工作坊的 4 個核心決策，用於指導 ASIL-B 安全系統的規格定義。

### 澄清 Q1：核心安全目標優先順序

**問題**: 針對 ASIL-B 級 SSD 控制器，哪 3 個核心安全目標應該優先保護？

**決策**: **選項 A** ✅ **推薦採納**
- **電源保護** (VDD): 防止供電中斷導致快閃記憶體資料損毀
- **時鐘監控** (CMN): 防止時鐘故障導致控制流程混亂
- **記憶體保護** (ECC/RAID): 防止位元翻轉導致資料遺失

**適用依據**:
- PCIe Gen5 SSD 典型故障模式分析
- ISO 26262-1:2018 安全目標定義原則
- ASIL-B 應用範例 (根據 AEC-Q100)

**影響範圍**:
- 決定了 SG 層級的 3 個主要安全目標
- 指導 FSR 的功能範圍定義
- 決定了系統驗證測試的重點項目

---

### 澄清 Q2：硬體/軟體職責分配邊界

**問題**: 如何清晰定義硬體和軟體在安全功能中的職責分配？

**決策**: **選項 A** ✅ **推薦採納**
- **硬體職責**: 故障**檢測** (µs 級響應)
- **硬體職責**: 故障**安全預設狀態** (無電流、無時鐘)
- **軟體職責**: 故障**管理** (ms 級反應、恢復邏輯)

**適用依據**:
- ISO 26262-3 Part 7 (硬體設計)
- 硬體/軟體分工最佳實踐
- ASIL-B 實時性要求

**影響範圍**:
- 決定了 SysReq 層級的功能分解方式
- 指導 TSR 的硬體/軟體邊界劃分
- 決定了 HSR 和 SSR 的職責分配表

**實施規則**:
```
SysReq → TSR 分配規則:
├─ 硬體快速檢測 (< 1μs) → HSR
├─ 軟體慢速管理 (5-100ms) → SSR  
└─ 硬體/軟體介面 (邏輯握手) → 兩者共同定義
```

---

### 澄清 Q3：驗證覆蓋率目標

**問題**: ASIL-B 系統應達到的量化驗證覆蓋率指標是多少？

**決策**: **選項 A** ✅ **推薦採納**
- **語句覆蓋率 (SC)**: **100%**
- **分支覆蓋率 (BC)**: **100%**
- **診斷覆蓋率 (DC)**: **> 90%**

**適用依據**:
- ISO 26262-6 (軟體測試方法和指標)
- ASPICE CL3 (能力等級 3 覆蓋率要求)
- ASIL-B 標準實踐基準

**影響範圍**:
- 指導軟體測試計畫的覆蓋率目標
- 決定了 SSR 驗證方法的量化標準
- 影響測試用例設計和驗收準則

**實施標準**:
```
軟體驗證覆蓋率 (ASIL-B 標準):
├─ 語句覆蓋率 (SC): 
│  ├─ 目標: 100%
│  ├─ 工具: Lizard / Code Coverage
│  └─ 驗收: 所有可執行語句被測試
│
├─ 分支覆蓋率 (BC):
│  ├─ 目標: 100%
│  ├─ 工具: Lizard / Branch Coverage
│  └─ 驗收: 所有 if/else/switch 分支被執行
│
└─ 診斷覆蓋率 (DC):
   ├─ 目標: > 90%
   ├─ 工具: FMEA / 故障樹分析
   └─ 驗收: > 90% 的軟體可檢測故障被覆蓋
```

---

### 澄清 Q4：ASIL 降級條件

**問題**: 根據 ISO 26262-3 Part 8 獨立故障假設，ASIL-B 可以降級到 ASIL-A 的條件是什麼？

**決策**: **選項 A** ✅ **推薦採納**
- **獨立故障源**: 硬體故障和軟體故障無共同根本原因
- **診斷覆蓋率**: 硬體故障檢測覆蓋率 > 90%
- **等效 ASIL 計算**: ASIL-B (硬體) + ASIL-B (軟體) = ASIL-A (組合)

**適用依據**:
- ISO 26262-3:2018, Part 8 (獨立故障假設)
- ASIL 降級數學模型 (故障率組合)
- 實時系統雙重故障概率論證

**應用場景**:
```
降級適用條件:
───────────────────────────────────────────────────

場景 1: VDD 監控 (典型應用)
├─ 硬體: VDD 監控電路 (類比比較器)
├─ 軟體: 故障管理器 (數位邏輯)
├─ 獨立性: 類比故障 ≠ 數位故障 ✓
├─ 硬體 DC: > 90% ✓
└─ 結論: TSR 可從 ASIL-B 降級到 ASIL-A

場景 2: 不適用 - 共同故障源
├─ 硬體: 電源模組 (為 FPGA 供電)
├─ 軟體: FPGA 邏輯控制
├─ 獨立性: 電源故障影響硬體和軟體 ✗
└─ 結論: 不能降級 (保持 ASIL-B)

場景 3: 不適用 - DC 不足
├─ 硬體: 故障檢測 DC = 85%
├─ 軟體: 故障反應 ASIL-B
├─ DC 檢查: 85% < 90% 阈值 ✗
└─ 結論: 不能降級 (需改進 DC 到 > 90%)
```

**降級論證模板**:
```
TSR-XXX: [需求名稱] 

當前 ASIL: ASIL-B
提議 ASIL: ASIL-A

降級論證:

1. 獨立故障假設驗證
   ├─ 硬體故障模式: [列舉，例: 比較器失效、RC 電路失效]
   ├─ 軟體故障模式: [列舉，例: 邏輯錯誤、計時錯誤]
   └─ 結論: 硬體故障 (類比) 與軟體故障 (數位) 無重疊 ✓

2. 故障率計算
   ├─ 硬體故障率 λ_HW: [數值] FIT
   ├─ 軟體故障率 λ_SW: [數值] FIT
   ├─ 組合概率: P_total = (λ_HW × λ_SW) / Σλ
   └─ 結果: P_total 達到 ASIL-A 水準 ✓

3. 診斷覆蓋率驗證
   ├─ 硬體 DC: [%] (需 > 90%)
   └─ 結論: DC 滿足 ASIL-A 要求 ✓

4. 批准簽核
   ├─ 安全工程師簽名: _______________
   ├─ 項目經理簽名: _______________
   └─ 質量部簽名: _______________
```

**影響範圍**:
- 允許某些 TSR 採用 ASIL-A 實現而非 ASIL-B
- 可降低硬體冗餘設計複雜度
- 必須完整文檔化論證過程

---

### 澄清決策摘要表

| 澄清項目 | 決策 | 適用範圍 | 優先級 |
|---------|------|---------|--------|
| Q1: 核心安全目標 | Power + Clock + Memory | SG 層級 (3 個目標) | **Critical** |
| Q2: HW/SW 分配 | HW 檢測 + HW 預設 + SW 管理 | SysReq/TSR 層級 | **Critical** |
| Q3: 驗證覆蓋率 | SC=100%, BC=100%, DC>90% | SSR 驗收標準 | **High** |
| Q4: ASIL 降級 | 獨立故障 + DC>90% | TSR 等級評估 | **High** |

---



### 完整的需求層級流

```
┌─────────────────────────────────────────────────────────────┐
│ 層級 0: 安全目標 (SG - Safety Goals)                          │
│ ├─ 定義系統應達到的安全狀態                                    │
│ ├─ 例: "防止電源故障導致資料遺失"                            │
│ └─ 語境: 系統層級，面向客戶/監管單位                          │
│                                                              │
│ ↓ (推導關係)                                                  │
│                                                              │
│ 層級 1: 功能安全需求 (FSR - Functional Safety Requirements) │
│ ├─ 定義系統必須實現什麼功能以達成 SG                         │
│ ├─ 例: "當 VDD < 2.7V 時進入安全狀態，延遲 < 10ms"          │
│ ├─ 特性: 功能性 + 時序 + 邊界條件                            │
│ └─ 語境: 功能層級，系統設計者使用                            │
│                                                              │
│ ↓ (推導關係)                                                  │
│                                                              │
│ 層級 2: 系統安全需求 (SysReq - System Safety Requirements)  │
│ ├─ 定義系統架構如何分解 FSR                                  │
│ ├─ 例: "硬體監控電路監控 VDD；軟體在 5ms 內反應"            │
│ ├─ 特性: 功能分解 + 介面定義 + 職責分配                      │
│ └─ 語境: 系統設計層級，架構決策                              │
│                                                              │
│ ↓ (推導關係)                                                  │
│                                                              │
│ 層級 3: 技術安全需求 (TSR - Technical Safety Requirements)  │
│ ├─ 定義技術實現方案以滿足 SysReq                            │
│ ├─ 例: "VDD 監控電路必須在 < 1μs 內輸出 FAULT 信號"         │
│ ├─ 特性: 量化標準 + 可驗證 + 實現獨立                        │
│ └─ 語境: 技術設計層級，系統設計者使用                        │
│                                                              │
│ ├─ TSR 分配 A (實現責任: 硬體)                               │
│ │    ↓                                                       │
│ │  硬體安全需求 (HSR - Hardware Safety Requirements)        │
│ │  ├─ 例: "監控電路在 VDD < 2.7V 時拉高 FAULT 信號"         │
│ │  └─ 由硬體設計規格 (HDD) 詳細實現                         │
│ │                                                           │
│ └─ TSR 分配 B (實現責任: 軟體)                               │
│      ↓                                                       │
│    軟體安全需求 (SSR - Software Safety Requirements)        │
│    ├─ 例: "故障監控任務每 2.5ms 檢查一次 FAULT 信號"        │
│    └─ 由軟體設計規格 (SDD) 詳細實現                         │
│                                                              │
│ ↓ (實現關係)                                                  │
│                                                              │
│ 層級 4: 實現代碼 (Code)                                       │
│ ├─ 硬體: RTL Verilog / SystemVerilog                         │
│ ├─ 軟體: C / MISRA C 代碼                                    │
│ └─ 由實現團隊負責                                            │
└─────────────────────────────────────────────────────────────┘
```

### 層級對應

| 層級 | 縮寫 | 定義者 | 驗證者 | 語境 |
|------|------|--------|--------|------|
| 0 | SG | 需求工程師/客戶 | 系統工程師 | 系統目標 |
| 1 | FSR | 系統工程師 | 設計/驗證團隊 | 功能需求 |
| 2 | SysReq | 系統設計師 | 架構評審 | 系統設計 |
| 3 | TSR | 系統設計師 | 技術評審 | 技術方案 |
| 3a | HSR | 硬體設計師 | 硬體驗證 | 硬體實現 |
| 3b | SSR | 軟體設計師 | 軟體驗證 | 軟體實現 |
| 4 | Code | 開發工程師 | 單元/整合測試 | 代碼實現 |

---

## 每層級的需求標準

### 層級 1: 功能安全需求 (FSR)

#### 定義
功能層面的安全需求，描述「系統需要做什麼」以確保安全。

#### 標準格式
```
FSR-[ID]: [簡要標題]

需求文本：
[以規範性語言陳述需求，使用「必須」(MUST) 等強制詞]

ASIL 等級: [ASIL-A/B/C/D 或 QM]
來源 (SG): [參考安全目標編號]
邊界條件:
  - [前提條件 1]
  - [前提條件 2]
  - [操作範圍]
驗證方法: [測試 / 分析 / 檢查]
```

#### 範例
```
FSR-001: VDD 電壓低保護

需求文本：
當輸入電壓 VDD 低於 2.7V 時，系統必須在 10ms 內進入安全狀態，
以防止快閃記憶體資料遺失。

ASIL 等級: ASIL-B
來源 (SG): SG-001 (確保電源故障時資料完整)
邊界條件:
  - 正常工作電壓: 3.3V ± 5% (3.135V - 3.465V)
  - 檢測電壓閾值: 2.7V ±50mV
  - 反應時間: 10ms ±2ms
  - 工作溫度: 0-85°C
驗證方法: 測試
```

#### 可驗證性準則
- ✓ 需求包含可測量的指標（如電壓、時間）
- ✓ 需求定義了邊界條件
- ✓ 需求使用規範性語言（MUST, SHALL, SHOULD）
- ✓ 需求無歧義（不包含「適當」、「合理」等模糊詞）
- ✓ 需求包含可以測試的驗收標準

---

### 層級 2: 系統安全需求 (SysReq)

#### 定義
系統設計層面的需求，描述「系統如何通過架構和元件分解來滿足 FSR」。

#### 標準格式
```
SysReq-[ID]: [簡要標題]

需求文本：
[描述系統的功能分解和元件職責]

對應 FSR: [FSR 編號]
分配方案:
  - 硬體責任: [簡述硬體部分]
  - 軟體責任: [簡述軟體部分]
  - 介面需求: [HW ↔ SW 介面要求]
```

#### 範例
```
SysReq-001: VDD 低壓保護系統設計

需求文本：
系統由硬體監控電路和軟體故障管理器組成。
硬體電路持續監控 VDD，當偵測到 VDD < 2.7V 時產生 FAULT 信號。
軟體故障管理器在收到 FAULT 信號後 5ms 內進入安全狀態。

對應 FSR: FSR-001
分配方案:
  - 硬體責任: VDD 監控和故障檢測（延遲 < 1ms）
  - 軟體責任: 故障反應和安全狀態轉遷（延遲 < 5ms）
  - 介面需求: 
    * 信號: FAULT (HW → SW, 高有效)
    * 時序: FAULT 脈衝 > 1μs
    * 協議: ISR 觸發 + 故障標誌設置
```

#### 可驗證性準則
- ✓ SysReq 與對應的 FSR 完全追蹤
- ✓ SysReq 明確分配硬體和軟體責任
- ✓ SysReq 定義了硬體/軟體介面
- ✓ SysReq 中各元件的時序和邊界一致且可疊加達到 FSR 要求
- ✓ 無遺漏的功能職責

---

### 層級 3: 技術安全需求 (TSR)

#### 定義
技術實現層面的需求，描述「用什麼技術方案來實現 SysReq」。

#### 標準格式
```
TSR-[ID]: [簡要標題]

需求文本：
[具體的技術實現要求，定量、可驗證]

對應 SysReq: [SysReq 編號]
ASIL 等級: [ASIL-A/B/C/D]
分類: [故障檢測 / 控制 / 隔離 / 故障安全 / 監控]
實現邊界:
  - 硬體部分: [詳述]
  - 軟體部分: [詳述]
  - 介面部分: [詳述]
驗證方法: [測試 / 分析 / 檢查]
驗收標準: [具體的通過/失敗準則]
```

#### 範例 A：硬體 TSR
```
TSR-001: VDD 監控電路故障檢測

需求文本：
VDD 監控電路必須使用比較器電路持續監控輸入電壓，
當 VDD 低於 2.65V (±50mV) 時，必須在 < 1μs 內產生 FAULT 信號高脈衝。
FAULT 信號必須保持高電平至故障清除。

對應 SysReq: SysReq-001 (硬體部分)
ASIL 等級: ASIL-B
分類: 故障檢測
實現邊界:
  - 硬體: 比較器 + 計時電路 + 輸出緩衝
  - 軟體: N/A
  - 介面: FAULT 輸出 (3.3V TTL)
驗證方法: 測試（硬體仿真 + 後矽驗證）
驗收標準:
  a) VDD 在 2.65V - 2.75V 之間逐步變化，測量 FAULT 輸出延遲
  b) 延遲必須 < 1μs，容差 ±10%
  c) FAULT 信號脈衝寬度 > 1μs
```

#### 範例 B：軟體 TSR
```
TSR-002: 軟體故障檢測和反應

需求文本：
軟體故障監控任務 (SysMon) 必須每 2.5ms 檢查一次 FAULT 信號狀態。
當檢測到 FAULT 信號高電平時，必須在 5ms 內設置故障標誌 (fault_flag)，
觸發故障管理器進入故障處理狀態機。

對應 SysReq: SysReq-001 (軟體部分)
ASIL 等級: ASIL-B
分類: 故障檢測 + 控制
實現邊界:
  - 硬體: 中斷線路 (FAULT → IRQ)
  - 軟體: ISR 和 fault_flag 設置邏輯
  - 介面: ISR 觸發協議
驗證方法: 測試 + 分析
驗收標準:
  a) 注入 FAULT 信號，測量軟體反應時間
  b) 反應時間必須 < 5ms
  c) 故障標誌必須正確設置
  d) 覆蓋率分析確認所有代碼路徑被測試
```

#### 可驗證性準則 (TSR)
- ✓ TSR 與對應的 SysReq 完全追蹤
- ✓ TSR 使用具體的技術術語和量化標準
- ✓ TSR 明確指定驗證方法（測試、分析、檢查）
- ✓ TSR 定義了具體的驗收標準（可通過/失敗判定）
- ✓ TSR 分類清晰（故障檢測、控制、隔離等）
- ✓ 硬體和軟體的職責和介面清楚

---

### 層級 3a: 硬體安全需求 (HSR)

#### 定義
從 TSR 分配到硬體的具體需求，由硬體設計規格 (HDD) 詳細實現。

#### 標準格式
```
HSR-[ID]: [簡要標題]

需求文本：
[硬體實現的具體要求]

對應 TSR: [TSR 編號]
ASIL 等級: [ASIL]
實現模塊: [硬體模塊名稱]
故障安全狀態: [故障時的預設狀態]
驗證層級: [單元測試 / 整合測試]
```

#### 範例
```
HSR-001: VDD 監控比較器

需求文本：
模擬前端 (AFE) 監控電路必須使用低噪聲比較器監控 VDD，
當 VDD < 2.65V 時立即輸出高電平 FAULT 信號。
監控電路本身的故障（如比較器失效）必須由冗餘監控路徑檢測。

對應 TSR: TSR-001
ASIL 等級: ASIL-B
實現模塊: VDD Monitor Circuit (AFE Subsystem)
故障安全狀態: FAULT 默認低 (無故障)；故障時高 (故障)
驗證層級: 單元測試（硬體仿真）+ 後矽驗證
```

---

### 層級 3b: 軟體安全需求 (SSR)

#### 定義
從 TSR 分配到軟體的具體需求，由軟體設計規格 (SDD) 詳細實現。

#### 標準格式
```
SSR-[ID]: [簡要標題]

需求文本：
[軟體實現的具體要求]

對應 TSR: [TSR 編號]
ASIL 等級: [ASIL]
實現模塊: [軟體模塊名稱]
實現語言: [C / C++ / 其他]
驗證層級: [單元測試 / 整合測試]
```

#### 範例
```
SSR-001: 故障監控任務

需求文本：
SysMon 監控任務每 2.5ms 檢查一次 FAULT 信號。
當檢測到信號狀態變化時，設置故障標誌並觸發 ISR。
所有代碼路徑必須達到 100% 語句覆蓋率和 100% 分支覆蓋率。
代碼必須符合 MISRA C:2012 標準（零關鍵違規）。

對應 TSR: TSR-002
ASIL 等級: ASIL-B
實現模塊: System Monitor Service (SysMon)
實現語言: C99 with MISRA C:2012
驗證層級: 單元測試 + 整合測試
```

---

## 可驗證性準則

### 通用可驗證性檢查

每個需求（SG、FSR、SysReq、TSR、HSR、SSR）都必須滿足以下條件：

#### 1. **量化標準**
```
✗ 不可驗證: "系統必須快速反應"
✓ 可驗證:    "系統必須在 < 5ms 內反應"

✗ 不可驗證: "故障檢測覆蓋率必須足夠高"
✓ 可驗證:    "故障檢測覆蓋率 (DC) 必須 > 90%"
```

#### 2. **邊界條件定義**
```
✗ 不可驗證: "在正常溫度下"
✓ 可驗證:    "工作溫度 0-85°C"

✗ 不可驗證: "電源低時"
✓ 可驗證:    "VDD < 2.7V ±50mV"
```

#### 3. **驗證方法明確**
```
✗ 不清楚: "驗證該需求"
✓ 清楚:   "通過功能測試，監控 FAULT 信號延遲"

✗ 不清楚: "確認覆蓋率"
✓ 清楚:   "使用靜態分析工具 (Lizard) 檢查環境複雜度 ≤ 15"
```

#### 4. **驗收標準明確**
```
✗ 無驗收標準: "信號延遲應該很短"
✓ 有驗收標準: "信號延遲 < 1μs，測試 100 次，全部通過"

✗ 無驗收標準: "代碼品質良好"
✓ 有驗收標準: "MISRA C 違規 = 0 個關鍵 + 0 個嚴重"
```

#### 5. **可追蹤性**
```
✗ 孤立需求: TSR-001 無對應的 SysReq 或 FSR
✓ 可追蹤:    TSR-001 ← SysReq-001 ← FSR-001 ← SG-001
```

---

## 追蹤完整性標準

### 正向追蹤（需求流向）

每個層級的需求必須向下追蹤到實現層：

```
SG-001 (安全目標)
   ↓ [有對應的 FSR]
FSR-001 (功能安全需求)
   ↓ [有對應的 SysReq]
SysReq-001 (系統需求)
   ↓ [分配到 TSR]
TSR-001 (技術需求)
   ├─ [分配到 HSR] → HSR-001 (硬體實現)
   └─ [分配到 SSR] → SSR-001 (軟體實現)
```

### 反向追蹤（實現回溯）

每個實現層的需求必須向上追蹤回目標：

```
HSR-001 (硬體實現)
   ↑ [源自 TSR]
TSR-001 (技術需求)
   ↑ [源自 SysReq]
SysReq-001 (系統需求)
   ↑ [源自 FSR]
FSR-001 (功能安全需求)
   ↑ [源自 SG]
SG-001 (安全目標)
```

### 缺口檢測

追蹤完整性檢查清單：

- [ ] **正向缺口**: 是否存在無 FSR 支持的 SG？→ 需要添加 FSR
- [ ] **反向缺口**: 是否存在無 SG 來源的 FSR？→ 需要移除或補充 SG
- [ ] **分配缺口**: 是否存在無 HSR/SSR 實現的 TSR？→ 需要添加 HSR/SSR
- [ ] **孤立 HSR/SSR**: 是否存在無 TSR 支持的 HSR/SSR？→ 需要移除或補充 TSR
- [ ] **驗證缺口**: 是否所有需求都有驗證方法？→ 缺失的需要補充
- [ ] **覆蓋缺口**: 所有 FSR 都有對應的 TSR 實現嗎？→ 計算覆蓋率百分比

### 覆蓋率計算

```
正向覆蓋率 = (有 FSR 支持的 SG 數量) / (總 SG 數量) × 100%
           必須 = 100%

反向覆蓋率 = (有 HSR/SSR 實現的 TSR 數量) / (總 TSR 數量) × 100%
           必須 = 100%

實現覆蓋率 = (已實現的 HSR + SSR 數量) / (總 HSR + SSR 數量) × 100%
           必須 ≥ 100%（允許超集實現）
```

---

## ASIL 繼承規則

### 基本規則

#### 規則 1：直接繼承（默認）
```
FSR 的 ASIL = X
  ↓
TSR 的 ASIL = X (繼承 FSR 的等級)
  ↓
HSR/SSR 的 ASIL = X (繼承 TSR 的等級)
```

**例**:
```
FSR-001 (ASIL-B) 
  → TSR-001 (ASIL-B)
    → HSR-001 (ASIL-B)
    → SSR-001 (ASIL-B)
```

#### 規則 2：升級（需論證）
```
若 TSR 的失效會導致安全功能完全喪失，可升級

例: TSR-001 (ASIL-A) 是單點故障，無冗餘
  → 升級為 ASIL-B
  
需文檔化: 
- 為何需要升級的技術論證
- 故障影響分析
- 缺陷與預防措施
```

#### 規則 3：降級（需獨立故障假設論證）
```
若 HSR 和 SSR 都實現同一 TSR，且故障獨立
可基於 ISO 26262-3 Part 8 獨立故障假設降級

例: 
  TSR-001 (ASIL-B)
    → HSR-001 (ASIL-B) + SSR-001 (ASIL-B)
    
若硬體故障和軟體故障不相關，可組合為:
  等效 ASIL = ASIL-A (因為雙重故障概率降低)

需論證:
- 硬體故障模式 vs 軟體故障模式
- 獨立性論證（無共同故障模式）
- 故障率計算
```

### ASIL 繼承檢查表

對每個 TSR 檢查：

- [ ] TSR 的 ASIL 等級是否與 FSR 一致？
  - 是 ✓ 記錄為「繼承」
  - 否 ✓ 記錄升級或降級的論證

- [ ] 若升級，是否有故障分析支持？
  - 是 ✓ 記錄論證
  - 否 ✗ 需補充分析

- [ ] 若降級，是否有獨立故障假設論證？
  - 是 ✓ 記錄論證 + 故障率計算
  - 否 ✗ 需補充分析

- [ ] HSR/SSR 是否都記錄了 ASIL 等級？
  - 是 ✓
  - 否 ✗ 需補充

---

## 驗證方法對應

### 驗證方法分類

| 驗證方法 | 適用層級 | 工具/技術 | 優點 | 缺點 |
|---------|---------|---------|------|------|
| **測試** | TSR, HSR, SSR | UVM, pytest, 硬體仿真 | 最直接，可測真實行為 | 覆蓋率難以 100% |
| **分析** | FSR, SysReq, TSR | 故障樹、數學模型、FMEA | 全面覆蓋，無遺漏 | 需要專業知識 |
| **檢查** | 所有層級 | 靜態分析、程式碼審查 | 早期發現、成本低 | 難以捕捉邏輯缺陷 |
| **組合** | 所有層級 | 以上組合 | 最可靠 | 成本最高 |

### 層級與驗證方法對應

```
層級           推薦驗證方法        備註
───────────────────────────────────────────────
SG (安全目標)   分析 + 檢查        安全目標需要專家論證，無法直接測試
FSR (功能需求)  分析 + 檢查        功能定義需要評審，可通過安全分析驗證
SysReq (系統)   分析 + 檢查        系統設計需要評審
TSR (技術)      測試 + 分析 + 檢查  技術需求可部分測試 + 分析驗證
HSR (硬體)      測試               硬體可通過測試 (UVM, 後矽) 驗證
SSR (軟體)      測試 + 分析        軟體可通過單元/整合測試 + 靜態分析驗證
Code (代碼)     測試               代碼通過單元/整合/系統測試驗證
```

### 具體驗證方法範例

#### 測試方法

```
硬體 TSR 測試:
- UVM 功能驗證: 監控 FAULT 信號延遲 < 1μs
- 後矽測試 (Post-Silicon): 實際 ASIC 晶片驗證
- 邊界值測試: VDD = 2.65V, 2.70V, 2.75V 測試

軟體 SSR 測試:
- 單元測試: 每個函式的輸入/輸出驗證
- 整合測試: 軟體模塊間互動驗證
- 系統測試: 整個系統 HW+SW 驗證
- 場景測試: 故障注入，驗證故障處理

覆蓋率要求:
- 語句覆蓋率 (SC): ≥ 100% (ASPICE CL3)
- 分支覆蓋率 (BC): ≥ 100% (ASPICE CL3)
- 修正決策/條件覆蓋率 (MC/DC): 建議 ≥ 100% (ISO 26262-6)
```

#### 分析方法

```
故障分析:
- FMEA: 列舉所有故障模式，評估風險
- FTA: 故障樹分析，找根本原因
- DFA: 相關故障分析

性能分析:
- 時序分析: 計算最壞情況下的延遲
- 吞吐量分析: 計算系統處理能力
- 功耗分析: 計算功率消耗

可靠性分析:
- 故障率計算: λ (FIT) 計算
- MTBF/MTTR 分析
- 診斷覆蓋率 (DC) 計算
```

#### 檢查方法

```
程式碼審查:
- 靜態分析: MISRA C 合規性檢查
- Lint 檢查: 程式碼品質檢查
- 複雜度檢查: CC ≤ 15 (函式) / CC ≤ 10 (RTL)
- 代碼走查 (Code Walkthrough): 專家評審

設計評審:
- 需求評審: 評審需求清晰性 + 完整性
- 設計評審: 評審架構設計是否滿足需求
- 安全評審: 安全專家評審安全措施

追蹤評審:
- 需求評審: 檢查追蹤矩陣無缺口
- 變更追蹤: 需求變更後追蹤是否完整更新
```

---

## 常見澄清

### Q1: TSR 和 FSR 的區別是什麼？

**A**: 
- **FSR**: 從**功能角度**描述「做什麼」
  ```
  FSR-001: "當 VDD < 2.7V 時，系統必須在 10ms 內進入安全狀態"
  重點：功能定義、時序要求、邊界條件
  ```

- **TSR**: 從**技術角度**描述「如何做」
  ```
  TSR-001: "VDD 監控電路必須在 < 1μs 內產生 FAULT 信號"
  TSR-002: "軟體必須在 5ms 內檢測到信號並進入安全狀態"
  重點：技術方案、可量化標準、實現獨立
  ```

### Q2: 何時 TSR 應該分配到硬體，何時分配到軟體？

**A**: 決策表：

| 因素 | 優先硬體 | 優先軟體 | 備註 |
|------|---------|---------|------|
| 實時性 (< 1ms) | ✓ | ✗ | 硬體延遲 µs 級 |
| 故障檢測 | ✓ | ⚠ | 硬體可靠，軟體可能失效 |
| 故障安全狀態 | ✓ | ⚠ | 硬體默認安全 |
| 靈活性 | ✗ | ✓ | 軟體易升級 |
| 成本 | ✗ | ✓ | 軟體更廉價 |
| 複雜邏輯 | ✗ | ✓ | 軟體更靈活 |

### Q3: 如何驗證追蹤完整性？

**A**: 使用追蹤矩陣工具：

```
矩陣行: SG、FSR、TSR、HSR、SSR
矩陣列: 每個需求編號

檢查:
1. 正向完整性: 每行都有對應的下一層
2. 反向完整性: 每行都能追蹤回上一層
3. 無孤立: 無需求被遺漏
4. 無重複: 無需求重複分配

工具: Excel / Doors / 自動化腳本
```

### Q4: ASIL 升級或降級需要什麼論證？

**A**: 

**升級論證**:
```
理由: [詳述為何需要提升]
例: "此 TSR 是監控電路本身的故障檢測，失效會導致監控完全喪失"

故障影響: [分析故障後果]
例: "若監控失效，無法偵測 VDD 低壓，快閃資料將損毀"

ASIL 根據: [參考 ISO 26262]
例: "根據 ISO 26262-3，故障影響為 Catastrophic + 要求 ASIL-D"

設計對策: [如何防止故障]
例: "採用雙監控電路（獨立冗餘），一個故障時另一個仍能工作"
```

**降級論證**:
```
獨立故障假設: [說明硬體和軟體故障不相關]
例: "硬體監控是類比電路（VDD 監控），軟體是數位邏輯（故障處理）
     硬體故障（比較器失效）和軟體故障（邏輯錯誤）無共同根本原因"

故障率計算: [計算組合失效概率]
例: "λ_HW = 100 FIT, λ_SW = 50 FIT
     組合: λ_total = λ_HW × λ_SW / λ_HW+SW ..."

降級根據: [根據計算結果確定新 ASIL]
例: "基於獨立故障假設，ASIL-D 降級為 ASIL-B"

評審簽核: [需要安全專家和管理層簽核]
```

---

## 檢查清單

### 需求定義檢查清單

#### 功能安全需求 (FSR) 檢查
- [ ] 每個 FSR 都有明確的 ID 和標題
- [ ] 需求文本使用規範性語言（MUST, SHALL）
- [ ] 需求包含量化標準（數值、時間、百分比）
- [ ] 需求定義了邊界條件和前提
- [ ] 需求指定了 ASIL 等級
- [ ] 需求可追蹤回 SG
- [ ] 需求定義了驗證方法
- [ ] 沒有矛盾或歧義

#### 技術安全需求 (TSR) 檢查
- [ ] 每個 TSR 都有明確的 ID 和標題
- [ ] 需求文本具體、可驗證、可量化
- [ ] 需求定義了驗收標準
- [ ] 需求指定了 ASIL 等級
- [ ] 需求可追蹤回 FSR 和 SysReq
- [ ] 需求定義了驗證方法
- [ ] TSR 分類清晰（故障檢測/控制/隔離等）
- [ ] 硬體/軟體職責和介面明確

#### 硬體安全需求 (HSR) 檢查
- [ ] 每個 HSR 都有明確的 ID 和標題
- [ ] 需求明確定義了硬體功能
- [ ] 需求指定了 ASIL 等級（≥ 對應 TSR）
- [ ] 需求定義了故障安全狀態
- [ ] 需求可追蹤回 TSR
- [ ] 需求可驗證（通過測試/分析）

#### 軟體安全需求 (SSR) 檢查
- [ ] 每個 SSR 都有明確的 ID 和標題
- [ ] 需求明確定義了軟體功能
- [ ] 需求指定了 ASIL 等級（≥ 對應 TSR）
- [ ] 需求定義了驗證方法（測試 + 分析）
- [ ] 需求可追蹤回 TSR
- [ ] 需求指定了覆蓋率目標 (≥ 100%)

### 追蹤完整性檢查清單

- [ ] 所有 SG 都有對應的 FSR
- [ ] 所有 FSR 都有對應的 TSR
- [ ] 所有 TSR 都分配到 HSR、SSR 或兩者
- [ ] 所有 HSR 都可追蹤回 TSR
- [ ] 所有 SSR 都可追蹤回 TSR
- [ ] 追蹤矩陣無缺口（100% 覆蓋）
- [ ] 無孤立需求（都有來源和去向）

### 可驗證性檢查清單

- [ ] 每個需求都有量化標準
- [ ] 每個需求都定義了邊界條件
- [ ] 每個需求都有驗證方法
- [ ] 每個需求都有驗收標準
- [ ] 驗收標準可以客觀判定（通過/失敗）
- [ ] 無模糊詞（「適當」、「合理」等）

### ASIL 一致性檢查清單

- [ ] FSR 的 ASIL 等級合理（根據安全影響）
- [ ] TSR 的 ASIL ≥ 對應 FSR 的 ASIL
- [ ] HSR/SSR 的 ASIL ≥ 對應 TSR 的 ASIL
- [ ] 若升級或降級，有明確論證
- [ ] 所有 ASIL 决策都已簽核

### 審查與批准檢查清單

- [ ] 技術審查已完成（設計團隊評審）
- [ ] 安全審查已完成（安全專家評審）
- [ ] 管理審查已完成（項目經理評審）
- [ ] 所有審查意見已處理
- [ ] 文檔已版本化和簽核
- [ ] 追蹤矩陣已導出並歸檔
- [ ] 所有變更都記錄在案

---

## 總結

### 規格層級核心

| 層級 | 誰定義 | 誰驗證 | 關鍵標準 |
|------|--------|--------|---------|
| **SG** | 需求者 | 系統工程師 | 安全影響清晰 |
| **FSR** | 系統工程師 | 設計評審 | 功能 + 時序 + ASIL |
| **SysReq** | 系統設計師 | 架構評審 | 功能分解 + 介面 |
| **TSR** | 系統設計師 | 技術評審 | 量化 + 可驗證 + ASIL |
| **HSR** | 硬體設計師 | 硬體驗證 | 實現方案 + 驗收標準 |
| **SSR** | 軟體設計師 | 軟體驗證 | 實現方案 + 覆蓋率 |

### 成功的規格文檔特徵

✓ **完整**: SG → FSR → TSR → HSR/SSR 全鏈追蹤  
✓ **可驗證**: 每個需求都有量化標準和驗收準則  
✓ **可追蹤**: 雙向追蹤無缺口，覆蓋率 100%  
✓ **一致**: ASIL 等級合理，無矛盾  
✓ **清晰**: 無歧義，所有人都能理解  
✓ **可實現**: 需求切實可行，非異想天開  

---

**End of Specification Requirements Clarification Document**
